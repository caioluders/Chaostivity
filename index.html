<!DOCTYPE html>
<html>
<link type="text/css" rel="stylesheet" href="style.css" />
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
<body>
<div id="top_div">
	<a onclick="wtf()" id="wtf">?</a>
	<a id="reload" onclick="draw(document.getElementById('density').value,document.getElementById('opacity').value)">Reload</a>
	<div id="title_div">
		<canvas id="title_background" width="200" height="100">	Your browser does not support the HTML5 canvas tag , sorry :'( </canvas>
	</div>
	<a id="download">Download</a>
	<a onclick="window.print()" id="print_it">Print it!</a>
</div>
<div id="mid_div">
	<canvas id="pareidolia" width="400" height="200" >	Your browser does not support the HTML5 canvas tag , sorry :'( </canvas>
</div>
<div id="foot_div">
	<input id="density" type="range" min="0" max="100" onchange="draw(this.value,document.getElementById('opacity').value)" />
	<input id="opacity" type="range" min="0" max="100" onchange="draw(document.getElementById('density').value,this.value)" />
	<a id="print_type" onclick="select_print('a3')">A3</a>
	<a id="print_type" onclick="select_print('a4')">A4</a>
</div>

<script>
function draw( d , o ) {
	var c = document.getElementById("pareidolia");
	var ctx = c.getContext("2d");
	ctx.clearRect(0, 0, c.width, c.height);
	ctx.save()
	ctx.globalAlpha = parseInt(o)/100
	console.log(parseInt(o)/100)
	for (var i = 0 ; i < parseInt(d) ; i++ ) {
		ctx.beginPath();
		ctx.moveTo( Math.floor((Math.random() * 400)) ,Math.floor((Math.random() * 200)));
		ctx.lineTo(Math.floor((Math.random() * 400)),Math.floor((Math.random() * 200)));
		ctx.lineWidth = 0.5;
		ctx.globalAlpha = parseInt(o)/100
		ctx.stroke();
	}

	for (var i = 0 ; i < parseInt(d) ; i++ ) {
		ctx.beginPath();
		ctx.moveTo( Math.floor((Math.random() * 400)) ,Math.floor((Math.random() * 200)));
		ctx.bezierCurveTo(Math.floor((Math.random() * 400)), Math.floor((Math.random() * 200)), Math.floor((Math.random() * 400)), Math.floor((Math.random() * 200)), Math.floor((Math.random() * 400)), Math.floor((Math.random() * 200)));
		ctx.lineWidth = 0.5;
		ctx.globalAlpha = parseInt(o)/100
		ctx.stroke();
	}

	ctx.restore()
}

function downloadCanvas(link, canvasId, filename) {
    link.href = document.getElementById(canvasId).toDataURL();
    link.download = filename;
}

document.getElementById('download').addEventListener('click', function() {
    downloadCanvas(this, 'pareidolia', 'pareidolia.png');
}, false);

function wtf() {
	alert("I don't know WTF IS THIS !");
}

function select_print(t) {
	console.log(t) ;
}

CanvasRenderingContext2D.prototype.roundRect = function (x, y, width, height, radius, fill, stroke) {
    var cornerRadius = { upperLeft: 0, upperRight: 0, lowerLeft: 0, lowerRight: 0 };
    if (typeof stroke == "undefined") {
        stroke = true;
    }
    if (typeof radius === "object") {
        for (var side in radius) {
            cornerRadius[side] = radius[side];
        }
    }

    this.beginPath();
    this.moveTo(x + cornerRadius.upperLeft, y);
    this.lineTo(x + width - cornerRadius.upperRight, y);
    this.quadraticCurveTo(x + width, y, x + width, y + cornerRadius.upperRight);
    this.lineTo(x + width, y + height - cornerRadius.lowerRight);
    this.quadraticCurveTo(x + width, y + height, x + width - cornerRadius.lowerRight, y + height);
    this.lineTo(x + cornerRadius.lowerLeft, y + height);
    this.quadraticCurveTo(x, y + height, x, y + height - cornerRadius.lowerLeft);
    this.lineTo(x, y + cornerRadius.upperLeft);
    this.quadraticCurveTo(x, y, x + cornerRadius.upperLeft, y);
    this.closePath();
    if (stroke) {
        this.stroke();
    }
    if (fill) {
        this.fill();
    }
} 

var canvas = document.getElementById("title_background");
var c = canvas.getContext("2d");
c.fillStyle = "green";
c.roundRect(0, 0, 200, 100, {lowerLeft:30,lowerRight:30}, true, true);
c.fillStyle = "white";
c.font = "bold 25px Arial";
c.fillText("Chaostivity", 50, 50);

draw(50) ;

</script>

</body>
</html>
